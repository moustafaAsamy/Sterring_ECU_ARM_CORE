

#include "motor.h"
#include "pid.h"
#include "encoder.h"
#include "stdint.h"
void InitConsole(void);
extern void UARTprintf(const char *pcString, ...);
extern int  pid_loop(int target , int current_postion );
uint8_t encoder_reading_buffer[100]={0} ;
uint8_t set_point_buffer[10] ={0};
extern void  timer_start(void);
int sensor_Reading =0;
int control_action =0;
volatile int set__point =0;
extern void ButtonsInit(void);
void led_init(void);

int main()
{
    ButtonsInit();
    led_init();
    ecoder_init();
    motor_init();
    InitConsole();
    uint32_t i =0;
    for(i =0;i<65000;i++)
    {

    }
    set__point =-700;
    timer_start();
     // Turn_Left(0); //CWW
    //Turn_Right(15000);//CW
    while(1)
    {

    }
}

extern  void task_t(void)
{
 sensor_Reading = ecoder_read();
 control_action = pid_loop(set__point ,sensor_Reading);
 UARTprintf("%d \n",sensor_Reading);
 if(control_action >0)
 {
      Turn_Left( (8000- control_action) *10 );
 }
 else
 {
     control_action = -control_action;
      Turn_Right(  (8000-  control_action) *10  );
 }
}


extern void task_set_point_change(void)
{
    set__point = 800;
}
